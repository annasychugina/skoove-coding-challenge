// see https://github.com/WrathChaos/react-native-helpers/blob/master/lib/helpers/normalize/normalizeText.ts
import {WINDOW_HEIGHT, WINDOW_WIDTH} from './screenInfo';

const React = require('react-native');

const {PixelRatio} = React;

const pixelRatio = PixelRatio.get();

const normalize = (size: number) => {
  const deviceHeight = WINDOW_HEIGHT;
  const deviceWidth = WINDOW_WIDTH;
  if (pixelRatio >= 2 && pixelRatio < 3) {
    // iphone 5s and older Androids
    if (deviceWidth < 360) {
      return size * 0.95;
    }
    // iphone 5
    if (deviceHeight < 667) {
      return size;
      // iphone 6-6s
    } else if (deviceHeight >= 667 && deviceHeight <= 735) {
      return size * 1.15;
    }
    // older phablets
    return size * 1.25;
  } else if (pixelRatio >= 3 && pixelRatio < 3.5) {
    // catch Android font scaling on small machines
    // where pixel ratio / font scale ratio => 3:3
    if (deviceWidth <= 360) {
      return size;
    }
    // Catch other weird android width sizings
    if (deviceHeight < 667) {
      return size * 1.15;
      // catch in-between size Androids and scale font up
      // a tad but not too much
    }
    if (deviceHeight >= 667 && deviceHeight <= 735) {
      return size * 1.2;
    }
    // catch larger devices
    // ie iphone 6s plus / 7 plus / mi note 等等
    return size * 1.25;
  } else if (pixelRatio >= 3.5) {
    // catch Android font scaling on small machines
    // where pixel ratio / font scale ratio => 3:3
    if (deviceWidth <= 360) {
      return size;
      // Catch other smaller android height sizings
    }
    if (deviceHeight < 667) {
      return size * 1.2;
      // catch in-between size Androids and scale font up
      // a tad but not too much
    }
    if (deviceHeight >= 667 && deviceHeight <= 735) {
      return size * 1.25;
    }
    // catch larger phablet devices
    return size * 1.25;
  }
  // if older device ie pixelRatio !== 2 || 3 || 3.5
  else {
    return size;
  }
};

export const rem = (value: number) =>
  PixelRatio.roundToNearestPixel(normalize(value / 1.25));
